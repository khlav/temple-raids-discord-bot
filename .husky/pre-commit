echo "🔍 Running pre-commit checks..."

# Task 1: Lint and format staged files
echo "1/3 ⚡ Linting and formatting staged files..."
if pnpm lint-staged > /dev/null 2>&1; then
  echo "1/3 ✅ Linting and formatting passed"
else
  echo "1/3 ❌ Linting and formatting failed"
  echo "Running lint-staged to show errors:"
  pnpm lint-staged
  exit 1
fi

# Task 2: Type check staged files only
echo "2/3 🔍 Type checking staged files..."
if pnpm typecheck > /dev/null 2>&1; then
  echo "2/3 ✅ Type checking passed"
else
  echo "2/3 ❌ Type checking failed"
  echo "Running typecheck to show errors:"
  pnpm typecheck
  exit 1
fi

# Task 3: Check for common issues
echo "3/3 🔍 Checking for common issues..."
# Check for console.log statements in staged files
if git diff --cached --name-only | grep -E '\.ts$' | xargs grep -l 'console\.log' 2>/dev/null; then
  echo "3/3 ⚠️  Warning: console.log statements found in staged files"
  echo "   Consider removing or replacing with proper logging"
fi

# Check for TODO/FIXME comments in staged files
if git diff --cached --name-only | grep -E '\.ts$' | xargs grep -l -E '(TODO|FIXME|HACK)' 2>/dev/null; then
  echo "3/3 ⚠️  Warning: TODO/FIXME/HACK comments found in staged files"
  echo "   Consider addressing these before committing"
fi

echo "3/3 ✅ Pre-commit checks completed"
echo "🎉 Ready to commit!"
